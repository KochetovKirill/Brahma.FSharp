<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>tutorial</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# quotation to OpenCL translator."/>
    <meta name="author" content="Semyon Grigorev"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/Brahma.FSharp/content/style.css" />
    <script type="text/javascript" src="/Brahma.FSharp/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <!--li><a href="http://fsharp.org">fsharp.org</a></li-->
          <li><a href="http://github.com/YaccConstructor/Brahma.FSharp">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/Brahma.FSharp/index.html">Brahma.FSharp</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h2><a name="OpenCL-specific-operations" class="anchor" href="#OpenCL-specific-operations">OpenCL specific operations</a></h2>
<ul>
<li><a href="reference/brahma-fsharp-opencl-extensions.html">Data transfer operations</a></li>
<li><a href="reference/global-opencl.html">Supported kernel operations</a>.</li>
<li>Supported functions from System.Math and Microsoft.FSharp.Core.Operators: abs, acos, asin, atan, cos, cosh, exp, floor, log, log10, pow, sin, sinh, sqrt, tan, tanh</li>
</ul>
<h2><a name="Basic-constructions" class="anchor" href="#Basic-constructions">Basic constructions.</a></h2>
<h3><a name="Array-access" class="anchor" href="#Array-access">Array access</a></h3>
<p>Array "by index" access is supported.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">1</span>] <span class="o">&lt;-</span> <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>]
    @&gt;
</code></pre></td>
</tr>
</table>
<h3><a name="Binding" class="anchor" href="#Binding">Binding</a></h3>
<p>Basic "let" binding is supported. Note, that now we support only "variable bindings". Nested functions, closures are not supported.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="k">let</span> <span class="i">x</span> <span class="o">=</span> <span class="n">1</span>
            <span class="k">let</span> <span class="i">y</span> <span class="o">=</span> (<span class="i">x</span> <span class="o">-</span><span class="n">1</span>) <span class="o">*</span> (<span class="i">x</span> <span class="o">+</span> <span class="n">2</span>)
    @&gt;
</code></pre></td>
</tr>
</table>
<h3><a name="Mutable-binding" class="anchor" href="#Mutable-binding">Mutable binding</a></h3>
<p>Mutability is available by using of "let mutable" binding.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="k">let</span> <span class="k">mutable</span> <span class="i">x</span> <span class="o">=</span> <span class="n">1</span>
            <span class="i">x</span> <span class="o">&lt;-</span> <span class="i">x</span> <span class="o">*</span> <span class="n">2</span>
    @&gt;
</code></pre></td>
</tr>
</table>
<p>Note, that scopes are supported. So, you can "rebind" any name and "F#-style" visibility will be emuleted in target code. For example, next code will be translated correctly.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="k">let</span> <span class="i">i</span> <span class="o">=</span> <span class="n">2</span>
            <span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1..</span><span class="n">3</span> <span class="k">do</span>     
                <span class="i">buf</span><span class="o">.</span>[<span class="i">i</span>] <span class="o">&lt;-</span> <span class="i">buf</span><span class="o">.</span>[<span class="i">i</span>] <span class="o">+</span> <span class="n">1</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="i">i</span>
    @&gt;

<span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1..</span><span class="n">3</span> <span class="k">do</span>
                <span class="k">let</span> <span class="i">i</span> <span class="o">=</span> <span class="i">i</span> <span class="o">*</span> <span class="n">2</span>     
                <span class="i">buf</span><span class="o">.</span>[<span class="i">i</span>] <span class="o">&lt;-</span> <span class="n">0</span>
    @&gt;
</code></pre></td>
</tr>
</table>
<h2><a name="Control-flow" class="anchor" href="#Control-flow">Control flow</a></h2>
<h3><a name="Sequential-operations" class="anchor" href="#Sequential-operations">Sequential operations</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="n">2</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">1</span>] <span class="o">&lt;-</span> <span class="n">4</span>
    @&gt;
</code></pre></td>
</tr>
</table>
<h3><a name="WHILE-loop" class="anchor" href="#WHILE-loop">WHILE loop</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="k">-&gt;</span>
          <span class="k">while</span> <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;</span> <span class="n">5</span> <span class="k">do</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">+</span> <span class="n">1</span>
    @&gt;
</code></pre></td>
</tr>
</table>
<h3><a name="FOR-integer-range-loop" class="anchor" href="#FOR-integer-range-loop">FOR integer range loop</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="k">-&gt;</span> 
            <span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1..</span><span class="n">3</span> <span class="k">do</span> <span class="i">buf</span><span class="o">.</span>[<span class="i">i</span>] <span class="o">&lt;-</span> <span class="n">0</span>
    @&gt;
</code></pre></td>
</tr>
</table>
<h3><a name="Quotations-injection" class="anchor" href="#Quotations-injection">Quotations injection</a></h3>
<p>You can use "quotations injection" for code reusing or parameterization. For example, you can write something like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">myFun</span> <span class="o">=</span> &lt;@ <span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">y</span> <span class="o">-</span> <span class="i">x</span> @&gt;
<span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> (<span class="o">%</span><span class="i">myFun</span>) <span class="n">2</span> <span class="n">5</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">1</span>] <span class="o">&lt;-</span> (<span class="o">%</span><span class="i">myFun</span>) <span class="n">4</span> <span class="n">9</span>
    @&gt;

<span class="k">let</span> <span class="i">commandTemplate</span> <span class="i">f</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) <span class="k">-&gt;</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> (<span class="o">%</span><span class="i">f</span>) <span class="n">2</span> <span class="n">5</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">1</span>] <span class="o">&lt;-</span> (<span class="o">%</span><span class="i">f</span>) <span class="n">4</span> <span class="n">9</span>
    @&gt;

<span class="k">let</span> <span class="i">cmd1</span> <span class="o">=</span> <span class="i">commandTemplate</span>  &lt;@ <span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">y</span> <span class="o">-</span> <span class="i">x</span> @&gt;
<span class="k">let</span> <span class="i">cmd2</span> <span class="o">=</span> <span class="i">commandTemplate</span>  &lt;@ <span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">y</span> <span class="o">+</span> <span class="i">x</span> @&gt;
</code></pre></td>
</tr>
</table>
<h2><a name="Structs-and-tuples" class="anchor" href="#Structs-and-tuples">Structs and tuples</a></h2>
<p>Structs and tuples transferring and using in kernel code are supported.</p>
<h3><a name="Structs" class="anchor" href="#Structs">Structs</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span class="i">Struct</span>&gt;]
<span class="k">type</span> <span class="i">c</span> <span class="o">=</span>
    <span class="k">val</span> <span class="i">x</span><span class="o">:</span> <span class="i">int</span> 
    <span class="k">val</span> <span class="i">y</span><span class="o">:</span> <span class="i">int</span>
    <span class="k">new</span> (<span class="i">x1</span>, <span class="i">y1</span>) <span class="o">=</span> {<span class="i">x</span> <span class="o">=</span> <span class="i">x1</span>; <span class="i">y</span> <span class="o">=</span> <span class="i">y1</span>} 
    <span class="k">new</span> (<span class="i">x1</span>) <span class="o">=</span> {<span class="i">x</span> <span class="o">=</span> <span class="i">x1</span>; <span class="i">y</span> <span class="o">=</span> <span class="n">0</span>}

<span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span>(<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) (<span class="i">s</span><span class="o">:</span><span class="i">c</span>) <span class="k">-&gt;</span> 
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="i">s</span><span class="o">.</span><span class="i">x</span> <span class="o">+</span> <span class="i">s</span><span class="o">.</span><span class="i">y</span>
            <span class="k">let</span> <span class="i">s2</span> <span class="o">=</span> <span class="k">new</span> <span class="i">c</span>(<span class="n">6</span>)
            <span class="k">let</span> <span class="i">s3</span> <span class="o">=</span> <span class="k">new</span> <span class="i">c</span>(<span class="i">s2</span><span class="o">.</span><span class="i">y</span> <span class="o">+</span> <span class="n">6</span>)
            <span class="i">buf</span><span class="o">.</span>[<span class="n">1</span>] <span class="o">&lt;-</span> <span class="i">s2</span><span class="o">.</span><span class="i">x</span>
    @&gt;

<span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span>(<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) (<span class="i">arr</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">c</span><span class="o">&gt;</span>) <span class="k">-&gt;</span> 
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="i">arr</span><span class="o">.</span>[<span class="n">0</span>]<span class="o">.</span><span class="i">x</span>         
    @&gt;
</code></pre></td>
</tr>
</table>
<h3><a name="Tuples" class="anchor" href="#Tuples">Tuples</a></h3>
<p>Tuples support are limited. Single tuple trunsfer to GPU is supported, but methods Array.ToHost and Array.ToGPU is not.
Also you can use tuples in kernel code.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) (<span class="i">k1</span><span class="o">:</span><span class="i">int</span><span class="o">*</span><span class="i">int</span>) (<span class="i">k2</span><span class="o">:</span><span class="i">int64</span><span class="o">*</span><span class="i">byte</span>) (<span class="i">k3</span><span class="o">:</span><span class="i">float32</span><span class="o">*</span><span class="i">int</span>) <span class="k">-&gt;</span> 
            <span class="k">let</span> <span class="i">x</span> <span class="o">=</span> <span class="i">fst</span> <span class="i">k1</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="i">x</span>
            <span class="i">buf</span><span class="o">.</span>[<span class="n">1</span>] <span class="o">&lt;-</span> <span class="i">int</span>(<span class="i">fst</span> <span class="i">k3</span>)
    @&gt;

<span class="k">let</span> <span class="i">command</span> <span class="o">=</span> 
    &lt;@ 
        <span class="k">fun</span> (<span class="i">range</span><span class="o">:</span><span class="i">_1D</span>) (<span class="i">buf</span><span class="o">:</span><span class="i">array</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) <span class="k">-&gt;</span> 
            <span class="k">let</span> (<span class="i">a</span>, <span class="i">b</span>) <span class="o">=</span> (<span class="n">1</span>, <span class="n">2</span>)
            <span class="i">buf</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="i">a</span>
    @&gt;
</code></pre></td>
</tr>
</table>
<p><a href="">More examples.</a></p>


        </div>
        <div class="span3">
          <img src="/Brahma.FSharp/img/logo.png" alt="Brahma.FSharp" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">Brahma.FSharp</li>
            <li><a href="/Brahma.FSharp/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/Brahma.FSharp">Get Library via NuGet</a></li>
            <li><a href="http://github.com/YaccConstructor/Brahma.FSharp">Source Code on GitHub</a></li>
            <li><a href="/Brahma.FSharp/license.html">License</a></li>
            <li><a href="/Brahma.FSharp/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/Brahma.FSharp/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/Brahma.FSharp/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/YaccConstructor/Brahma.FSharp"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
